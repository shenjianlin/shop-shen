$().ready(function(){$("#div_login").keyup(function(p){if(p.which==13||p.keyCode==13){$("#btnLogin").click()}});$("#div_reg").keyup(function(p){if(p.which==13||p.keyCode==13){$("#btn_reg").click()}});j();function j(){var r=$("#div_login_reg");var s=$(window).width();var u=$(window).height();var t=$(document).scrollTop();var q=(s-r.width())/2;var p=(u-r.height())/2+t-20;r.css({left:q+"px",top:p+"px"})}if(getCookie("memberUsername")!=null){$("#isRememberUsername").prop("checked",true);$("#loginUsername").val(getCookie("memberUsername"));$("#loginPassword").focus()}else{$("#isRememberUsername").prop("checked",false);$("#loginUsername").focus()}$("#memberLogin").click(function(p){$("#div_login").show();$("#memberLoginLi").addClass("selected");$("#div_reg").hide();$("#memberRegisterLi").removeClass("selected")});$("#memberRegister").click(function(p){$("#div_reg").show();$("#memberRegisterLi").addClass("selected");$("#div_login").hide();$("#memberLoginLi").removeClass("selected")});$(".tc_close").click(function(p){$("#div_login_reg").hide()});$(window).bind("scroll",function(){j()});$("#btnLogin").click(function(){var q=$("#loginUsername").val();var p=$("#loginPassword").val();if(q==""||p==""){$("#loginError").html("<div class='prompt'> <i class='prompt_error'></i> <font class='red12'>用户名或密码错误，</font> <a class='wlma' href='"+shopxx.base+"/password/findPwdUsername.jhtml'>忘记密码?</a> </div>");return false}$.ajax({url:shopxx.base+"/common/public_key.jhtml",type:"GET",dataType:"json",cache:false,success:function(t){var s=new RSAKey();s.setPublic(b64tohex(t.modulus),b64tohex(t.exponent));var r=hex2b64(s.encrypt(p));$.ajax({url:shopxx.base+"/login/popSubmit.jhtml",type:"POST",dataType:"json",data:{loginUsername:q,enPassword:r},cache:false,success:function(u){if($("#isRememberUsername").prop("checked")){addCookie("memberUsername",q,{expires:7*24*60*60})}else{removeCookie("memberUsername")}if(u.type=="success"){var v=$("#redirectURL").val();location.href=v}else{$("#loginError").html("<div class='prompt'> <i class='prompt_error'></i> <font class='red12'>用户名或密码错误，</font> <a class='wlma'>忘记密码?</a> </div>")}}})}})});$("#loginUsername,#loginPassword").live("keyup",function(){$("#loginError").html("")});function n(q){var p=false;$.ajax({url:shopxx.base+"/register/check_username.jhtml?username="+q,type:"GET",dataType:"json",cache:false,async:false,success:function(r){p=r}});return p}$("#btn_reg").click(function(){var s=$.trim(b.val());var p=$.trim(k.val());var r=$.trim(g.val());var q=$.trim($("#captcha").val());$.ajax({url:shopxx.base+"/common/public_key.jhtml",type:"GET",dataType:"json",cache:false,success:function(v){var u=new RSAKey();u.setPublic(b64tohex(v.modulus),b64tohex(v.exponent));var t=hex2b64(u.encrypt(p));$.ajax({url:shopxx.base+"/register/submit.jhtml",type:"POST",dataType:"json",data:{captcha:q,username:s,enPassword:t},cache:false,success:function(w){if(w.type=="success"){var x=$("#redirectURL").val();location.href=x}else{$("#captchaImage").val("");$("#captchaImage").attr("src",shopxx.base+"/common/captchaImage.jhtml?timestamp="+(new Date()).valueOf());$("#captchaError").html("验证码不正确！");$("#captchaErrorDiv").show()}}})}})});var b=$("#regUsername");var c=$("#regUsernameRight");var a=$("#regUsernameError");var o=$("#regUsernameErrorDiv");b.live("focusout",function(){var q=$.trim(b.val());if(q==""){a.html("帐号不能为空！");c.html("");o.show();return false}if(!n(q)){a.html("帐号已经存在！");c.html("");o.show();return false}if(q=="手机号码"){a.html("请输入用户名！");c.html("");o.show();return false}c.html("<i class='prompt_success'></i>");if(q.match(/^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1})|(17[0-9]{1})|(14[0-9]{1}))+\d{8})$/)){$("#ccode").empty();$("#ccode").addClass("reg-pheyzm-li");var p="";p+="<input  class='ui-yatext' id='captcha' name='captcha' style='margin-right: 0; padding-left: 10px;width: 132px;' type='text' tabindex='1'  autocomplete='off'>";p+=" <input type='button' class='hq-yzm click-ysz' id='btnEmailSend' onclick='sendCode()' value='免费获取验证码' ></input>";p+=" <span class='prompt_sc'>";p+=" </span>";p+=" <div class='tip-box'>";p+=" <span class='yzm-sucts' id='promptTip'></span>";p+="<div class='prompt'>";p+="<font class='red12'></font>";p+="</div>";p+="</div>";$("#ccode").html(p)}else{a.html("格式错误，帐号只能是手机号码！");c.html("");o.show()}});b.live("focusin",function(){c.html("");a.html("");o.hide()});var k=$("#regPassword");var e=$("#regPasswordRight");var d=$("#regPasswordError");var h=$("#regPasswordErrorDiv");k.live("focusout",function(){var p=$.trim(k.val());if(p==""){e.html("");d.html("设置密码不能为空！");h.show();return false}if(p.length<6||p.length>20){e.html("");$("#regPasswordError").html("设置密码长度为6~20位！");$("#regPasswordErrorDiv").show();return false}e.html("<i class='prompt_success'></i>")});k.live("focusin",function(){e.html("");d.html("");h.hide()});var g=$("#confirmRegPassword");var l=$("#confirmRegPasswordRight");var f=$("#confirmRegPasswordError");var i=$("#confirmRegPasswordErrorDiv");g.live("focusout",function(){var q=$.trim(g.val());var p=k.val();if(q==""){l.html("");f.html("确认密码不能为空！");i.show();return false}if(q!=p){l.html("");f.html("确认密码与设置密码不一致！");i.show();return false}l.html("<i class='prompt_success'></i>")});g.live("focusin",function(){l.html("");f.html("");i.hide()});$("#captcha").live("focusout",function(){var p=$.trim($("#captcha").val());if(p==""){$("#captchaRight").html("");$("#captchaError").html("验证码不能为空！");$("#captchaErrorDiv").show();return false}if(p.length!=4){$("#captchaRight").html("");$("#captchaError").html("验证码长度必须是4位！");$("#captchaErrorDiv").show();return false}if(!m(p)){$("#captchaRight").html("");$("#captchaError").html("验证码不正确！");$("#captchaErrorDiv").show();return false}$("#captchaRight").html("<i class='prompt_success'></i>")});$("#captcha").live("focusin",function(){$("#captchaRight").html("");$("#captchaError").html("");$("#captchaErrorDiv").hide()});function m(q){var p=false;$.ajax({url:shopxx.base+"/common/checkCaptcha.jhtml?captcha="+q,type:"GET",dataType:"json",cache:false,async:false,success:function(r){p=r}});return p}});function updateCaptcha(){$("#captchaImage").attr("src",shopxx.base+"/common/captchaImage.jhtml?timestamp="+(new Date()).valueOf())}var findPwdInterval;function sendCode(){var a=$("#regUsername").val();jQuery.ajax({url:shopxx.base+"/register/getCode.jhtml?userName="+a,type:"POST",dataType:"json",cache:false,success:function(b){if(b.message.type=="success"){jQuery("#btnEmailSend").prop("disabled",true);jQuery("#btnEmailSend").prop("value","发送中...");jQuery("#btnEmailSend").prop("class","click-ysz-after");findPwdInterval=setInterval(showSecordSpan,1000);jQuery("#promptTip").html("验证码已发送，请注意查收")}else{jQuery("#promptTip").html("发送失败！")}}})}var findValidateSecords=120;function showSecordSpan(){jQuery("#btnEmailSend").prop("value",findValidateSecords+"秒后重新发送");findValidateSecords--;if(findValidateSecords==0){clearInterval(findPwdInterval);jQuery("#btnEmailSend").prop("disabled",false);jQuery("#btnEmailSend").prop("class","click-ysz");jQuery("#btnEmailSend").prop("value","没收到？重新获取");jQuery("#msgEmailDefault").html("");findValidateSecords=100}};