Sy.ns("Sy.shop.product");(function(c){var p=0;var j=99;var o=0;var u=0;var x="";function f(){var I="Prod_Cookies_";var H;var G=9;var E;if($.cookie(I)==null){$.cookie(I,p,{expires:7,path:"/"})}else{E=$.cookie(I)}if(E!=null&&E!=""){var D=E.split(",");E=p;var F=D.length<G?D.length:G;for(var C=0;C<F;C++){if(D[C]!=p){E=E+","+D[C]}}$.cookie(I,E,{expires:7,path:"/"})}}function e(){$.ajax({url:"/product/merchant.jhtml",type:"GET",data:{id:p},dataType:"json",cache:false,async:false,success:function(C){if(C!=null){$(".p-dsf-xx").find("i").html(C.name);if(C.isSupporMail){$(".cppp-mc").html(C.fullName);$(".fast_product_tag").hide()}else{$(".cppp-mc").html("<i>闪购自营</i>"+C.fullName);a()}if(!C.isSupporPoint&&C.isSupporMail){$(".productPoint").html("0")}if(C.phone){$(".cppp-tel").html("电话："+C.phone)}if(C.isMarketable){$("#disableCart").html("商品已售罄")}else{$("#disableCart").html("门店未上架")}}else{$("#disableCart").html("加入购物车");$(".p-dsf-xx").html("此商品不支持在当前区域销售")}}})}function g(){$("#disableCart").hide();$.ajax({url:"/product/stock.jhtml",type:"GET",data:{id:p},dataType:"json",cache:false,async:false,success:function(C){if(C<=0){$("#disableCart").show();$(".jrgwc").hide()}else{$(".jrgwc").show();$("#disableCart").hide()}}})}function k(){var C=$(".cpdt").height();$("html,body").animate({scrollTop:C},200)}function q(){var C=0;var D=0;$.ajax({url:"/product/getProductScoreById.jhtml?id="+p,type:"GET",dataType:"json",async:false,cache:false,success:function(E){if(E!=null){C=E.score;D=E.scoreCount}}});return C+","+D}function l(){var C=q();var E=C.split(",")[1];var F=C.split(",")[0];F=parseFloat(F).toFixed(2);$("#commentSpan").html("("+E+")");$("#scorep").html("评分数："+E);if(E==0){$("#commentCount").html("没人评价？让我来！")}else{$("#commentCount").html("已有"+E+"人评价")}if(F==0){$("#productScore").html("未评分")}else{$("#productScore").html(F+"分")}var D="<span style='width:";if(F!=null&&F!=""){D+=F*20+"%'>"}D+="</span>";$("#productGrade").append(D);$("#commentScore").append(D);var D="<dd style='width:";if(F!=null&&F!=""){D+=F*20+"%'>"}D+="<em>"+F+"</em></dd>";$("#reviewScore").prepend(D);$("#bigScore").append(F)}c.reviewForPage=function(C){var D="/member/review/listAjax.jhtml";$.getJSON(D,{productId:p,currentPage:C},function(F){$("#reviewTable").empty();var G="";$.each(F.content,function(H,I){G+="<div class='pllb'><ul><li class='hytx'>";if(I.portraitPath!=null&&I.portraitPath!=""){if(I.portraitPath.indexOf("http:")>-1){G+="<img src='"+I.portraitPath+"' width='60px' height='60px'>"}else{G+="<img src='"+attachSite+I.portraitPath+"' width='60px' height='60px'>"}}else{G+="<img src='/resources/images/login/member_index_default.jpg' width='60px' height='60px'>"}G+="</li></ul><ul class='plxq_k'><i class='spll_lsj'></i>";G+="<li><span class='plmc'>";if(I.reviewer.length>6){G+=I.reviewer.substring(0,2)+"****"+I.reviewer.substring(6,I.reviewer.length)+"(匿名)"}else{G+="****(匿名)"}G+="</span>"+I.createDate+"</li>";if(I.score!=null&&I.score!=""&&I.score>0){G+="<li><span class='pfs'><span style='width:";G+=I.score*20+"%'>";G+="</span></span></li>"}else{G+="<li><span class='pfs'><span style='width:0.0%'></span></span></li>"}G+="<li class='plpl_nr'>"+I.content+"</li>";if(I.reply!=null&&I.reply!=""){G+="<li class='plp1_nrplhf'>";G+="<i class='hfico'></i>";G+="<dl class='plpl_nrhf_l'><font class='juh'>回复：</font></dl>";G+="<dl class='plpl_nrhf_r'>";G+="<font>"+I.reply+"</font>";G+="<p style='color:#b0b0b0;font-family:'arial';'>"+I.replyDate+"</p>";G+="</dl>";G+="<div class='clear'></div>";G+="</li>";G+="<div class='clear'></div>"}G+="</ul><div class='clear'></div></div>"});$("#reviewTable").append(G);if(F.totalPage>0){if(o!=0){var E=$(".rxsptj_bt").position().top;$("html,body").animate({scrollTop:E},200)}pageInit("reviewPageDiv",F.currentPage,F.totalPage,"Sy.shop.product.reviewForPage","上一页","下一页");o=1}})};function s(){c.reviewForPage(1)}c.consultationForPage=function(D){var C="/member/consultation/listAjax.jhtml";$.getJSON(C,{productId:p,currentPage:D},function(F){$("#consultationTable").empty();var E="";$.each(F.content,function(G,H){E+="<div class='pllb'><ul><li class='hytx'>";if(H.portraitPath!=null&&H.portraitPath!=""){if(H.portraitPath.indexOf("http:")>-1){E+="<img src='"+H.portraitPath+"' width='60px' height='60px'>"}else{E+="<img src='"+attachSite+H.portraitPath+"' width='60px' height='60px'>"}}else{E+="<img src='/resources/images/login/member_index_default.jpg' width='60px' height='60px'>"}E+="</li></ul><ul class='plxq_k2'><i class='spll_lsj'></i>";E+="<li class='plxq_k2_l'><span class='plmc'>";if(H.isAnonymous==1){E+=H.memberName.substring(0,2)+"***"+H.memberName.substring(H.memberName.length-2,H.memberName.length)+"(匿名)"}else{E+=H.memberName}E+="</span>"+H.createDate+"</li>";var I="";if(H.replyConsultations.length>0){$.each(H.replyConsultations,function(J,K){I+="<li class='plp1_nr3'><dl class='plpl_nr_l'><font class='juh'>回复：</font></dl><dl class='plpl_nr_r'><font class='juh'>"+K.content+"</font></dl><div class='clear'></div></li>"})}E+="<li class='plpl_nr2'><dl class='plpl_nr_r'>"+H.content+"</dl><div class='clear'></div></li>";if(I!=""){E+=I}E+="</ul><div class='clear'></div></div>"});$("#consultationTable").append(E);if(F.totalPage>0){if(u!=0){k()}pageInit("consultationPageDiv",F.currentPage,F.totalPage,"Sy.shop.product.consultationForPage","上一页","下一页");u=1}})};function v(){$.ajax({url:"/member/getMemberNameAndPortraitPath.jhtml",type:"GET",dataType:"json",cache:false,async:false,success:function(E){var F=E.username;var C=E.portraitPath;$("#userName").html(F);$("#consultationDiv").show();var D="<a href='/member/index.jhtml' target='_blank'>";if(C!=null&&C!=""){D+="<img src='"+attachSite+C+"' width='60px' height='60px'>"}else{D+="<img src='/resources/images/login/member_index_default.jpg' width='60px' height='60px'>"}D+="</a>";$("#img").html(D)}})}function z(){var C=window.location.href;var D=C.indexOf("#consultationDiv");if(D>0){v()}}function h(){c.consultationForPage(1);$("#addConsultation").click(function(){if($.checkLogin()){v();return true}else{$("#consultationDiv").show();var C="/products/content/"+p+".html?#consultationDiv";$("#redirectURL").val(C);$("#div_login_reg").show();return false}});$("#submitConsultation").click(function(){var D=$("#content").val();var E=0;var F=$("#isAnonymous").attr("checked");if(F=="checked"){E=1}var C=$("#productId").val();if(D==""){showMessageDiv("warn","咨询内容必填");return false}$.ajax({url:"/member/consultation/save.jhtml",type:"POST",data:{productId:C,content:D,isAnonymous:E},dataType:"json",success:function(G){showMessageDiv(G.type,G.content);h();$("#isAnonymous").attr("checked",false);$("#content").val("")}})});$("#cancelConsultation").click(function(){$("#consultationDiv").hide();$("#content").val("");$("#isAnonymous").attr("checked",false)});$("#consultationDiv").find("textarea").focus(function(){if(!$.checkLogin()){$("#consultationDiv").show();var C="/products/content/"+p+".html?#consultationDiv";$("#redirectURL").val(C);$("#div_login_reg").show();$("#submitConsultation").attr("disabled","disabled");$("#content").attr("disabled","disabled");$("#isAnonymous").attr("disabled","disabled");return false}});z()}function d(){$("#zoom").jqzoom({zoomWidth:368,zoomHeight:368,title:false,showPreload:false,preloadImages:false});var C=$(".items li");if(C!=null&&C.length>5){$("#scrollable").scrollable()}$("#scrollable a").hover(function(){var D=$(this);if(D.hasClass("current")){return false}else{$("#scrollable a").removeClass("current");D.addClass("current").click()}})}function A(){var C=$("#quantity");var D=$("#quantityProduct");$("#increase").click(function(){var E=C.val();if(E>=j){return}if(/^\d*[1-9]\d*$/.test(E)){C.val(parseInt(E)+1)}else{C.val(1)}D.val(C.val())});$("#decrease").click(function(){var E=C.val();if(/^\d*[1-9]\d*$/.test(E)&&parseInt(E)>1){C.val(parseInt(E)-1)}else{C.val(1)}D.val(C.val())});C.each(function(){var E=$(this);E.data("value",E.val())});C.bind("input propertychange change",function(E){if(E.type!="propertychange"||E.originalEvent.propertyName=="value"){var F=C.val();if(F>j){C.val(j)}else{if(/^\d*[1-9]\d*$/.test(F)){}else{C.val(C.data("value"))}}D.val(C.val())}})}function i(){$("#fenk li").each(function(D,C){$(this).click(function(E){x=$(this).attr("id");if(x=="xico_intro"){$("#introDiv").show();$("#attrDiv").hide();$("#commentDiv").show();$("#advisoryDiv").show();$(this).find("a").addClass("dq")}else{if(x=="xico_spec"){$("#introDiv").show();$("#attrDiv").show();$("#commentDiv").show();$("#advisoryDiv").show();$(this).find("a").addClass("dq")}else{if(x=="xico_comment"){$("#introDiv").hide();$("#attrDiv").hide();$("#commentDiv").show();$("#advisoryDiv").hide();$(this).find("a").addClass("dq")}else{if(x=="xico_advisory"){$("#introDiv").hide();$("#attrDiv").hide();$("#commentDiv").hide();$("#advisoryDiv").show();$(this).find("a").addClass("dq")}}}}k();$("#fenk li").each(function(G,F){if($(this).attr("id")!=x){$(this).find("a").removeClass("dq")}})})})}function B(){$("#cartInfoDiv").html("");$("#cartInfoDiv").hide()}function b(){window.open("/cart/list.jhtml")}function w(C){$.ajax({url:"/product/hits.jhtml",type:"GET",data:{id:C}})}function a(){$.ajax({url:"/product/calcShoppingDays.jhtml",type:"GET",data:{productId:p},dataType:"json",success:function(C){if(C.shoppingTime!=""){if(C.shoppingTime=="0"){$(".product_psdz span").after("<em>支持2小时送达</em>")}else{$(".product_psdz span").after("预计 <em>"+C.shoppingTime+"</em> 送达")}}}})}function n(){var C=$("#specification").find("a");if(C.length>0){var D=$("#productSpecValues").val().split(",");C.click(function(){if(!$(this).hasClass("locked")){$(this).toggleClass("selected");if($(this).hasClass("selected")){$(this).parents("dl").find("a").removeClass("selected");$(this).addClass("selected")}$("#specification").find("dl").each(function(I,L){var K=new Array();$("#specification").find("dl").each(function(N,M){if(I!=N&&$(M).find(".selected").length>0){K.push($(M).find(".selected").attr("val"))}});if(K.length>0){var F=new Array();for(var H=0;H<D.length;H++){var J=true;for(var G=0;G<K.length;G++){if(D[H].indexOf("-"+K[G]+"-")==-1){J=false}}if(J){F.push(D[H])}}$(L).find("a").addClass("locked");$(L).find("a").each(function(O,M){for(var N=0;N<F.length;N++){if(F[N].indexOf("-"+$(M).attr("val")+"-")>-1){$(M).removeClass("locked");break}}})}else{$(L).find("a").removeClass("locked")}})}if($(this).hasClass("image")){var E=$(this).attr("title");$(".xphoto").find("li").hide();if(!$(this).hasClass("selected")){$(".xphoto").find("li").show();$(".xphoto").find("li:first").find("a").click();return false}$(".xphoto").find("li").each(function(G,F){if($(F).attr("title")==E||$(F).attr("title")==""){$(F).show();if(!$(F).is(":hidden")){if($(F).attr("title")==E){$(F).find("a").click()}}}})}})}}var t=0;c.countDown=function(F){if(t>=0){var H=Math.floor(t/(3600*24));var C=Math.floor(t%(3600*24)/3600);var E=Math.floor(t%3600/60);var G=Math.floor(t%60);var D=F;if(H!=0){D=D+"<b>"+H+"</b>天"}D=D+"<b>"+C+"</b>小时<b>"+E+"</b>分<b>"+G+"</b>秒";$(".promotion_product_p").find(".sales-promotion-txt").html(D);--t}else{$(".promotion_product_p").find(".sales-promotion-txt").html(F+"<b>0</b>小时<b>0</b>分<b>0</b>秒")}};function r(){$("a.combTabClass").click(function(){if(!$(this).hasClass("click")){$(".combTabClass").removeClass("click");$(this).addClass("click");$(".stabcon").hide();var C=$(this).parent().index();$($(".stabcon").get(C)).show()}})}function y(){$.ajax({url:"/product/productActive.jhtml",type:"GET",data:{id:p},dataType:"json",cache:false,async:false,success:function(C){if(C!=null){if(C.activeType==1||C.activeType==2||C.activeType==3||C.activeType==4||C.activeType==7){Sy.shop.product.promotion.init(C)}else{if(C.activeType==5){Sy.shop.product.presell.init(C)}else{if(C.activeType==6){Sy.shop.product.groups.init(C)}else{if(C.productPrice!=null){$(".ps_price").html("￥"+currency(C.productPrice.price,false));$("#priceDescription").html("闪购价:￥"+currency(C.productPrice.price,false))}$("#loadingCart").removeClass("jrgwc_disable").addClass("jrgwc").addClass("addCart");$("#loadingCart").html("加入购物车");if(C.activeType==0&&C.promotionProduct!=null){$(".product_promotion_li").show();$(".promotion_product_p").show();$(".promotion_product_p").find(".sales-promotion").html("活动预告");t=C.between;setInterval("Sy.shop.product.countDown('距离开卖还有')",1000)}}}}}}})}function m(){$.ajax({url:"/promotion/order/getJoinOrderPromotions.jhtml",type:"GET",data:{productId:p},dataType:"json",cache:false,async:false,success:function(D){if(D.length>0){if($(".order-promotion-dd-div").length>0){var C="";$.each(D,function(E,F){C+='<p><span class="order-promotion">'+F.orderPromotionTypeName+"</span>";C+='<span class="order-promotion-txt">';$.each(F.listOrderPromotionCondition,function(H,I){C+=I.conditionName+"&nbsp;";if(I.orderPromotionGifts.length>0){$.each(I.orderPromotionGifts,function(J,K){C+='<em class="maizeng-warp">';C+='<a class="maizeng" href="#">';if(K.giftQuanity<=0){C+='<font color="#999999">';C+=K.giftName;C+="[已赠完]</font>"}else{C+=K.giftName}C+='<span class="zeng">';C+='<img width="160" height="160" src="'+K.mediumImage+'">';C+="</span>";C+="</a>";C+="</em>";C+="&nbsp;"})}});C+="活动截止日期";var G=F.endTime.split(" ")[0].split("-");C+="<b>"+G[1]+"</b>月<b>"+G[2]+"</b>日";C+="</span></p>"});$(".order-promotion-dd-div").html(C);$(".order-promotion-li").show()}}}})}c.changeMaxQuantity=function(C){if(C>0&&C<j){j=C}};c.pageInit=function(D,C){p=D;if(C>0){j=C}n();f();w(D);m();e();y();g();l();s();h();d();A();i();r();browseProduct(D,"content_otherSalesProduct",5);hostSalesProduct(D,"content_hostSalesProduct",5)}})(Sy.shop.product);